const S3_BUCKET="https://etymoscope.com/",defaultWidth=1e3,color=d3.scaleOrdinal(d3.schemeCategory20),fullGraph=requestFullGraphFromS3(),emptyGraph=JSON.parse('{"nodes": [], "links": []}');var form=d3.select("form").on("submit",function(){getSubgraphAndDrawIt(this.wordInput.value,2)});function requestFullGraphFromS3(){let t=new XMLHttpRequest,e=S3_BUCKET+"data/etymograph.json";return t.open("GET",e,!1),t.send(),JSON.parse(t.responseText)}function getSubgraph(t,e){if(0==fullGraph.nodes.filter(function(e){return e.id==t}).length)return emptyGraph;let n=new Set([t]);for(let t=0;t<e;t++){var r=fullGraph.links.filter(function(t){return!(!n.has(t.source)&&!n.has(t.target))});r.forEach(function(t){n.add(t.source),n.add(t.target)})}return{nodes:JSON.parse(JSON.stringify(Array.from(n).map(function(t){return{id:t}}))),links:JSON.parse(JSON.stringify(Array.from(r)))}}function selectSatisfactoryDimensions(t){var e=t.nodes.length;return[defaultWidth,Math.min(Math.round(3*e+450),1600)]}function draw(t,e){let n=selectSatisfactoryDimensions(t),r=n[0],a=n[1],o=5,i="0 0 "+r+" "+a;d3.select("#d3-container").append("div").classed("svg-container",!0).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox",i).classed("svg-content-responsive",!0);var s=d3.select("svg"),c=d3.forceSimulation(t.nodes).force("link",d3.forceLink().id(function(t){return t.id}).links(t.links).distance(10).strength(1.2)).force("charge",d3.forceManyBody().strength(-800).distanceMax(350)).force("collide",d3.forceCollide().strength(1).radius(8)).force("center",d3.forceCenter(r/2,a/2.5)),l=s.append("g").attr("class","links").selectAll("line").data(t.links).enter().append("line").attr("stroke-width",function(t){return 4}),d=s.selectAll(".node").data(t.nodes).enter().append("g").attr("class","node").on("click",function(t,e){h.push(d3.select(this).node())}).on("dblclick",function(t,e){window.open("https://www.etymonline.com/word/"+t.id,"_blank")});d.append("circle").attr("r",function(t){return o}).attr("fill",function(t){return color(t.group)}),d.append("title").text(function(t){return t.id});var u=12,f=6,p=80;d.append("text").attr("dx",u).attr("dy",f).text(function(t){return t.id}),d3.selectAll(".node").filter(function(t){return t.id===e}).selectAll("circle").style("fill","orange");var h=[];c.nodes(t.nodes).on("tick",function(){d.attr("cx",function(t){return t.x=Math.max(o+u,Math.min(r-o-u-p,t.x))}).attr("cy",function(t){return t.y=Math.max(o+f,Math.min(a-o-f-p,t.y))}),l.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),d.attr("transform",function(t){return"translate("+t.x+","+t.y+")"})})}function getSubgraphAndDrawIt(t,e){null!==d3.event&&d3.event.preventDefault();let n=getSubgraph(t,e);d3.select("svg")&&d3.select("svg").remove(),draw(n,t)}