var API_ROOT="http://localhost",S3_BUCKET="https://s3-us-west-2.amazonaws.com/etymoscope-public/",defaultWidth=1e3,defaultHeight=700,minWidth=1e3,minHeight=500,maxWidth=1200,maxHeight=1400,color=d3.scaleOrdinal(d3.schemeCategory20),fullGraph=requestFullGraphFromS3(),emptyGraph=JSON.parse('{"nodes": [], "edges": []}'),form=d3.select("form").on("submit",function(){getSubgraphAndDrawIt(this.wordInput.value,2)});function requestFullGraphFromS3(){var t=new XMLHttpRequest,e=S3_BUCKET+"data/etymograph.json";return console.log(e),t.open("GET",e,!1),t.send(),JSON.parse(t.responseText)}function getSubgraph(t,e,n){for(var r=new Set([e]),a=0;a<n;){var i=t.links.filter(function(t){return!(!r.has(t.source)&&!r.has(t.target))});i.forEach(function(t){r.add(t.source),r.add(t.target)}),a+=1}return{nodes:Array.from(r).map(function(t){return{id:t}}),links:i}}function selectSatisfactoryDimensions(t){var e=t.nodes.length;if(e<20)var n=minWidth,r=minHeight;else if(e<100)n=defaultWidth,r=defaultHeight;else n=maxWidth,r=maxHeight;return[n,r]}function draw(t,e){dimensions=selectSatisfactoryDimensions(t);var n=dimensions[0],r=dimensions[1];d3.select("#d3-container").append("svg").attr("width",n).attr("height",r);var a=d3.select("svg"),i=d3.forceSimulation(t.nodes).force("link",d3.forceLink().id(function(t){return t.id}).links(t.links).distance(15).strength(1)).force("charge",d3.forceManyBody().strength(-800).distanceMax(350)).force("collide",d3.forceCollide().strength(1).radius(8)).force("center",d3.forceCenter(n/2,r/2)),o=a.append("g").attr("class","links").selectAll("line").data(t.links).enter().append("line").attr("stroke-width",function(t){return 4}),s=a.selectAll(".node").data(t.nodes).enter().append("g").attr("class","node").on("click",function(t,e){c.push(d3.select(this).node())}).on("dblclick",function(t,e){window.open("https://www.etymonline.com/word/"+t.id,"_blank")});s.append("circle").attr("r",function(t){return 6}).attr("fill",function(t){return color(t.group)}),s.append("title").text(function(t){return t.id});s.append("text").attr("dx",12).attr("dy",6).text(function(t){return t.id}),d3.selectAll(".node").filter(function(t){return t.id===e}).selectAll("circle").style("fill","orange");var c=[];i.nodes(t.nodes).on("tick",function(){s.attr("cx",function(t){return t.x=Math.max(18,Math.min(n-6-12-80,t.x))}).attr("cy",function(t){return t.y=Math.max(12,Math.min(r-6-6-80,t.y))}),o.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),s.attr("transform",function(t){return"translate("+t.x+","+t.y+")"})})}function getSubgraphAndDrawIt(t,e){null!==d3.event&&d3.event.preventDefault();var n=getSubgraph(fullGraph,t,e);d3.select("svg").remove(),draw(n,t)}